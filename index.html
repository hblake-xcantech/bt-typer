<!doctype html>
<title>MediaStreamDestination test</title>
<button id="beep">Beep</button>
<audio id="out" autoplay></audio>
<div id="status"></div>
<script>
let actx;
document.getElementById('beep').onclick = async () => {
  if (!actx) {
    actx = new (window.AudioContext||window.webkitAudioContext)();
  }
  if (actx.state !== 'running') await actx.resume();
  const dest = actx.createMediaStreamDestination();
  document.getElementById('out').srcObject = dest.stream;

  const osc = actx.createOscillator();
  osc.frequency.value = 1000;
  const gain = actx.createGain();
  gain.gain.value = 0.5;
  osc.connect(gain).connect(dest);
  osc.start();
  setTimeout(()=>osc.stop(),1000);
  document.getElementById('status').textContent = "Played via MediaStreamDestination";
};
</script>
